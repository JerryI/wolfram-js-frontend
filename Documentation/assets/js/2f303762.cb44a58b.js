"use strict";(self.webpackChunkwlx_docs=self.webpackChunkwlx_docs||[]).push([[1096],{58100:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>g,frontMatter:()=>s,metadata:()=>r,toc:()=>d});var t=a(17624),i=a(4552);const s={authors:"jerryi",tags:["javascript"],enableComments:!0},o="Dynamic gauge",r={permalink:"/blog/2024/04/22/gauge",source:"@site/blog/2024-04-22-gauge.md",title:"Dynamic gauge",description:"Today we will implement a simple gauge using Javascript and HTML and then integrate it to Wolfram Language.",date:"2024-04-22T00:00:00.000Z",tags:[{label:"javascript",permalink:"/blog/tags/javascript"}],readingTime:2.71,hasTruncateMarker:!0,authors:[{name:"Kirill Vasin",title:"Maintainer",url:"https://github.com/JerryI",imageURL:"https://avatars.githubusercontent.com/u/4111822?s=48&v=4",key:"jerryi"}],frontMatter:{authors:"jerryi",tags:["javascript"],enableComments:!0},unlisted:!1,prevItem:{title:"Dynamic color and opacity implementation",permalink:"/blog/2024/04/24/dynamic-env"},nextItem:{title:"Procedural spider animation",permalink:"/blog/spider"}},l={authorsImageUrls:[void 0]},d=[{value:"Javascript",id:"javascript",level:2},{value:"Dynamics",id:"dynamics",level:2},{value:"Cleaning up",id:"cleaning-up",level:2},{value:"The simplest way",id:"the-simplest-way",level:3},{value:"Treating as a decoration",id:"treating-as-a-decoration",level:3}];function c(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",em:"em",h2:"h2",h3:"h3",img:"img",p:"p",pre:"pre",...(0,i.M)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"Today we will implement a simple gauge using Javascript and HTML and then integrate it to Wolfram Language."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:a(49524).c+"",width:"1606",height:"272"})}),"\n",(0,t.jsx)(n.h2,{id:"javascript",children:"Javascript"}),"\n",(0,t.jsx)(n.p,{children:"Using AI assistant, one can directly ask"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"write a gauge in Javascript"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"With some minor modifications we end up with the following code"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:".js\n\ncore.gauge = async (args, env) => {\n  \n  // Create a gauge meter element\n  const gauge = document.createElement('div');\n  gauge.style.width = '100px'; // half the original width\n  gauge.style.height = '50px'; // half the original height\n  gauge.style.border = '1px solid #000';\n  gauge.style.borderRadius = '50px 50px 0 0'; // adjusted for smaller size\n  gauge.style.position = 'relative';\n  gauge.style.background = 'linear-gradient(to right, red 0%, yellow 50%, green 100%)';\n\n  // Create a needle for the gauge\n  const needle = document.createElement('div');\n  needle.style.width = '2px';\n  needle.style.height = '40px'; // made the needle longer for better visibility\n  needle.style.background = '#000';\n  needle.style.position = 'absolute';\n  needle.style.bottom = '0';\n  needle.style.left = '50%';\n  needle.style.transformOrigin = 'bottom';\n\n  // Function to set the needle position based on input value\n  function setNeedlePosition(value) {\n    // Ensure value is between 0 and 1\n    value = Math.max(0, Math.min(1, value));\n    // Convert value to angle\n    const angle = value * 180 - 90; // -90 to 90 degrees\n    needle.style.transform = `rotate(${angle}deg)`;\n  }\n\n  // Set initial needle position\n  const pos = await interpretate(args[0], env);\n  setNeedlePosition(pos); // Middle position\n  \n\n  gauge.appendChild(needle);\n\n  env.element.appendChild(gauge);\n  env.local.update = setNeedlePosition;\n}\n\ncore.gauge.update = async (args, env) => {\n  const val = await interpretate(args[0], env);\n  env.local.update(val);\n}\n\ncore.gauge.destroy = () => {\n  console.log('Nothing to do');\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:["It already includes all dynamic methods such as ",(0,t.jsx)(n.code,{children:"update"})," and ",(0,t.jsx)(n.code,{children:"destroy"})," used to update the meter, once the data has been changed."]}),"\n",(0,t.jsx)(n.p,{children:"To test is we can write"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-mathematica",children:"gauge[0.3] // CreateFrontEndObject\n"})}),"\n",(0,t.jsx)(n.h2,{id:"dynamics",children:"Dynamics"}),"\n",(0,t.jsxs)(n.p,{children:["We have already implemented ",(0,t.jsx)(n.code,{children:"update"})," method, then we can directly hook it up to a slider"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-mathematica",children:"gvalue = 0.1;\nEventHandler[InputRange[0, 1, 0.1, 0.1], (gvalue = #) &]\n\ngauge[gvalue // Offload] // CreateFrontEndObject\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:a(10790).c+"",width:"800",height:"189"})}),"\n",(0,t.jsx)(n.h2,{id:"cleaning-up",children:"Cleaning up"}),"\n",(0,t.jsxs)(n.p,{children:["We don't have to create FrontEndObject manually each time, it is can be done using ",(0,t.jsx)(n.code,{children:"StandardForm"})," and ",(0,t.jsx)(n.code,{children:"MakeBoxes"}),". There is a few way on how to implement it."]}),"\n",(0,t.jsx)(n.h3,{id:"the-simplest-way",children:"The simplest way"}),"\n",(0,t.jsx)(n.p,{children:"One can force Wolfram Kernel to execute output expression on WLJS Interpreter via"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-mathematica",metastring:'title="change 1"',children:"gauge /: MakeBoxes[g_gauge, StandardForm] := With[{\n  o = CreateFrontEndObject[g]\n},\n  MakeBoxes[o, StandardForm]\n]\n"})}),"\n",(0,t.jsx)(n.p,{children:"then we can freely do now"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-mathematica",metastring:'title="change 2"',children:"gvalue = 0.1;\nEventHandler[InputRange[0, 1, 0.1, 0.1], (gvalue = #) &]\n\ngauge[gvalue // Offload]\n"})}),"\n",(0,t.jsxs)(n.admonition,{type:"warning",children:[(0,t.jsx)(n.p,{children:"This makes expression not copyable from notebook to notebook, what you will see under the symbol is something like this"}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-mathematica",children:'(*VB[*)(FrontEndRef["35fa850e-5bfd-48ab-84b2-dc815f5f2666"])(*,*)(*"1:eJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKG5umJVqYGqTqmialpeiaWCQm6VqYJBnppiRbGJqmmaYZmZmZAQCMcRXe"*)(*]VB*)\n'})}),(0,t.jsxs)(n.p,{children:["See ",(0,t.jsx)(n.a,{href:"#Treating%20as%20a%20decoration",children:"Treating as a decoration"})," on how to fix this"]})]}),"\n",(0,t.jsx)(n.h3,{id:"treating-as-a-decoration",children:"Treating as a decoration"}),"\n",(0,t.jsxs)(n.p,{children:["We can preserve the original symbol by just decorating it using ",(0,t.jsx)(n.code,{children:"ViewBox"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-mathematica",metastring:'title="change 1"',children:"gauge /: MakeBoxes[g_gauge, StandardForm] := With[{\n\n},\n  ViewBox[g, g // FrontEndVirtual]\n]\n"})}),"\n",(0,t.jsxs)(n.p,{children:["here ",(0,t.jsx)(n.code,{children:"FrontEndVirtual"})," accounts for creation a container for our instance similar to ",(0,t.jsx)(n.code,{children:"CreateFrontEndObject"}),", but it does not allocate a storage and keeps the original expression."]}),"\n",(0,t.jsx)(n.p,{children:"Now it is the same as it was before"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-mathematica",metastring:'title="change 2"',children:"gvalue = 0.1;\nEventHandler[InputRange[0, 1, 0.1, 0.1], (gvalue = #) &]\n\ngauge[gvalue // Offload]\n"})}),"\n",(0,t.jsx)(n.p,{children:"But if you try to copy it, you will see"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-mathematica",children:'(*VB[*)(gauge[Offload[gvalue]])(*,*)(*"1:eJxTTMoPSmNkYGAoZgESHvk5KRAeP5BwK8rPK3HNSwnLLCopTcyBSLACifTE0vRUCJcdSPinpeXkJ6YUs4GkyhJzSlMBOCoUGw=="*)(*]VB*)\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.em,{children:"The original expression is preserved!"})})]})}function g(e={}){const{wrapper:n}={...(0,i.M)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},49524:(e,n,a)=>{a.d(n,{c:()=>t});const t=a.p+"assets/images/Screenshot 2024-05-25 at 09.26.26-0896d2ee3507228ab8d4be445fba2b2b.png"},10790:(e,n,a)=>{a.d(n,{c:()=>t});const t=a.p+"assets/images/gauge4-ezgif.com-video-to-gif-converter-afc317c8d3a9ced6ead95b9929b5b3a2.gif"},4552:(e,n,a)=>{a.d(n,{I:()=>r,M:()=>o});var t=a(11504);const i={},s=t.createContext(i);function o(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);