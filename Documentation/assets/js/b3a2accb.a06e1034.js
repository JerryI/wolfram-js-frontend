"use strict";(self.webpackChunkwlx_docs=self.webpackChunkwlx_docs||[]).push([[1698],{78268:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>m,frontMatter:()=>s,metadata:()=>o,toc:()=>d});var t=i(17624),a=i(4552);const s={draft:!1},r=void 0,o={id:"frontend/Advanced/Dynamics/Raster animation",title:"Raster animation",description:"Raster graphics is not well optimized on WLJS Notebook for now. Consider to use it as rarely as possible.",source:"@site/docs/frontend/Advanced/Dynamics/Raster animation.md",sourceDirName:"frontend/Advanced/Dynamics",slug:"/frontend/Advanced/Dynamics/Raster animation",permalink:"/frontend/Advanced/Dynamics/Raster animation",draft:!1,unlisted:!1,tags:[],version:"current",lastUpdatedAt:1718527269e3,frontMatter:{draft:!1},sidebar:"tutorialSidebar",previous:{title:"Prototyping",permalink:"/frontend/Advanced/Dynamics/Prototyping"},next:{title:"Scoping",permalink:"/frontend/Advanced/Dynamics/Scoping"}},c={},d=[{value:"Implementation",id:"implementation",level:3}];function l(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.M)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.admonition,{type:"warning",children:(0,t.jsx)(n.p,{children:"Raster graphics is not well optimized on WLJS Notebook for now. Consider to use it as rarely as possible."})}),"\n",(0,t.jsxs)(n.p,{children:["All raster graphics is rendered using ",(0,t.jsx)(n.a,{href:"/frontend/Reference/Graphics/Image",children:"Image"})," expression, which also supports dynamic updates using ",(0,t.jsx)(n.a,{href:"/frontend/Reference/Interpreter/Offload",children:"Offload"})," expression."]}),"\n",(0,t.jsxs)(n.p,{children:["Let us start from the practical example - ",(0,t.jsx)(n.strong,{children:"image distortion"})]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.img,{src:i(15592).c+"",width:"2560",height:"1280"}),"\n",(0,t.jsx)(n.em,{children:"Yandex Open Source Jam 2024"})]}),"\n",(0,t.jsx)(n.p,{children:"or this one"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.img,{src:i(26532).c+"",width:"641",height:"482"}),"\n",(0,t.jsxs)(n.em,{children:[(0,t.jsx)(n.a,{href:"https://stackoverflow.com/questions/36174431/how-to-make-a-wave-warp-effect-in-shader",children:"Stackoverflow"})," OpenGL"]})]}),"\n",(0,t.jsx)(n.h3,{id:"implementation",children:"Implementation"}),"\n",(0,t.jsx)(n.p,{children:"Let us take an example image firstly. Drag and drop it to an editor"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:i(52372).c+"",width:"1530",height:"398"})}),"\n",(0,t.jsx)(n.p,{children:"and take a raw data from it as a sequence of bytes"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-mathematica",children:'img = ImageData[(* image *), "Byte"];\n'})}),"\n",(0,t.jsx)(n.p,{children:"Now we can apply map function to it, which stretches and shrinks pixels periodically"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-mathematica",children:"shader = Compile[{{img, _Integer, 3}, {phase, _Real}}, Module[{iter},\n  With[{\n    ysize = Length[img],\n    xsize = Length[img[[1]]]\n  },\n    Table[\n    iter = 1.0;\n    Table[With[{\n      yr = y,\n      xr = If[# < 1, 1, If[# > xsize, xsize, #]] &@ Round[iter]\n    },\n\n      iter = iter + (1.0 + 0.7 Sin[6 Pi x / xsize + phase]);\n\n      img[[yr, xr]]\n      \n      \n    ],  {x, xsize}], {y, ysize}] \n  ]\n]];\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Here we use ",(0,t.jsx)(n.code,{children:"Compile"})," to speed the process up, since there are only real arrays are involved. We do not apply any antialiasing filters, it does it in the nearest neighbors approximation. Let's check the result using the original ",(0,t.jsx)(n.code,{children:"Byte"})," encoding"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-mathematica",children:'Image[NumericArray[shader[img, 0], "UnsignedInteger8"], "Byte"] \n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:i(93388).c+"",width:"711",height:"349"})}),"\n",(0,t.jsxs)(n.admonition,{type:"tip",children:[(0,t.jsxs)(n.p,{children:["Always provide a typed numeric array as a first argument to ",(0,t.jsx)(n.a,{href:"/frontend/Reference/Graphics/Image",children:"Image"}),". By the default it assumes ",(0,t.jsx)(n.code,{children:"Real"})," format of pixels data. Therefore we explicitly tell the encoding by sending ",(0,t.jsx)(n.code,{children:"Byte"})," as a second argument."]}),(0,t.jsx)(n.p,{children:"The most efficient way is to use"}),(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"UnsignedInteger8"})," : ",(0,t.jsx)(n.code,{children:"Byte"})]}),"\n"]})]}),"\n",(0,t.jsxs)(n.p,{children:["Since a performance is it great with raster graphics, we can rely on fixed time intervals while animating or a straight ",(0,t.jsx)(n.code,{children:"Do"})," loop"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-mathematica",metastring:'title="cell 1"',children:'imageFrame = NumericArray[img, "UnsignedInteger8"];\nImage[imageFrame // Offload, "Byte"]\n'})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-mathematica",metastring:'title="cell 2"',children:'Do[\n  imageFrame = NumericArray[shader[img, angle], "UnsignedInteger8"];\n, {angle, 0, 4Pi, 2Pi/30.0}]\n'})}),"\n",(0,t.jsx)(n.p,{children:"The resulting animation"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:i(31996).c+"",width:"482",height:"346"})})]})}function m(e={}){const{wrapper:n}={...(0,a.M)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},15592:(e,n,i)=>{i.d(n,{c:()=>t});const t=i.p+"assets/images/Pasted image 20240514150707-b0d1e01e65464a81901279a741e916b7.png"},26532:(e,n,i)=>{i.d(n,{c:()=>t});const t=i.p+"assets/images/Pasted image 20240514150822-e6a140ba047f64db2649e38c40a24b40.png"},93388:(e,n,i)=>{i.d(n,{c:()=>t});const t=i.p+"assets/images/Screenshot 2024-05-14 at 15.18.05-7814fe04dc652fa5c9ddf85a3ed942ef.png"},52372:(e,n,i)=>{i.d(n,{c:()=>t});const t=i.p+"assets/images/Screenshot 2024-06-16 at 11.17.10-3b523ea15a160307324ea20e8db34d3e.png"},31996:(e,n,i)=>{i.d(n,{c:()=>t});const t=i.p+"assets/images/goood-ezgif.com-optimize-f9408ecd1d27eedc351e5015a7aee603.gif"},4552:(e,n,i)=>{i.d(n,{I:()=>o,M:()=>r});var t=i(11504);const a={},s=t.createContext(a);function r(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);