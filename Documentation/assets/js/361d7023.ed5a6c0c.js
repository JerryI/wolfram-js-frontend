"use strict";(self.webpackChunkwlx_docs=self.webpackChunkwlx_docs||[]).push([[9668],{25136:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>s,default:()=>h,frontMatter:()=>r,metadata:()=>c,toc:()=>o});var i=t(17624),a=t(4552);const r={draft:!1},s=void 0,c={id:"frontend/Advanced/Javascript/Communication",title:"Communication",description:"Here we will highlight a few methods for communication with Javascript",source:"@site/docs/frontend/Advanced/Javascript/Communication.md",sourceDirName:"frontend/Advanced/Javascript",slug:"/frontend/Advanced/Javascript/Communication",permalink:"/frontend/Advanced/Javascript/Communication",draft:!1,unlisted:!1,tags:[],version:"current",lastUpdatedAt:1711835414e3,frontMatter:{draft:!1},sidebar:"tutorialSidebar",previous:{title:"Controls",permalink:"/frontend/Advanced/Graphics/Controls"},next:{title:"1. Creating new type",permalink:"/frontend/Advanced/Objects/Creating new type"}},l={},o=[{value:"Direct call",id:"direct-call",level:2},{value:"Execution in the container",id:"execution-in-the-container",level:2},{value:"Data fetching",id:"data-fetching",level:2},{value:"Emitting events",id:"emitting-events",level:2},{value:"Custom UI component",id:"custom-ui-component",level:3},{value:"Integrating with standard inputs",id:"integrating-with-standard-inputs",level:3},{value:"Using WLX",id:"using-wlx",level:3},{value:"Side effects",id:"side-effects",level:4},{value:"Emit event from WLJS",id:"emit-event-from-wljs",level:3},{value:"Request evaluation",id:"request-evaluation",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",p:"p",pre:"pre",strong:"strong",...(0,a.M)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"Here we will highlight a few methods for communication with Javascript"}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:["See also ",(0,i.jsx)(n.a,{href:"/frontend/Advanced/Frontend%20interpretation/WLJS%20Functions",children:"WLJS Functions"})]})}),"\n",(0,i.jsx)(n.h2,{id:"direct-call",children:"Direct call"}),"\n",(0,i.jsx)(n.p,{children:"Let us define our dummy function"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",metastring:'title="cell 1"',children:".js\ncore.MyFunction = async (args, env) => {\n  const data = await interpretate(args[0], env);\n  alert(data);\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["then the fastest and most direct way of calling it is using ",(0,i.jsx)(n.a,{href:"/frontend/Reference/Frontend%20IO/FrontSubmit",children:"FrontSubmit"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mathematica",metastring:'title="cell 2"',children:'FrontSubmit[MyFunction["Hello World!"]]\n'})}),"\n",(0,i.jsx)(n.p,{children:"or chaining it with some other WLJS function"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mathematica",children:"FrontSubmit[MyFunction[ReadClipboard[]]]\n"})}),"\n",(0,i.jsx)(n.h2,{id:"execution-in-the-container",children:"Execution in the container"}),"\n",(0,i.jsxs)(n.p,{children:["So-called containers gives a DOM element, local memory for our function (see more ",(0,i.jsx)(n.a,{href:"/frontend/Advanced/Frontend%20interpretation/WLJS%20Functions",children:"WLJS Functions"}),")"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",metastring:'title="cell 1"',children:'.js\n\ncore.MyFunction2 = async (args, env) => {\n  const data = await interpretate(args[0], env);\n  env.element.innerHTML = `<span style="color:red">${data}</span>`;\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"Now we can call it from our cell"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mathematica",metastring:'title="cell 2"',children:'CreateFrontEndObject[MyFunction2["Hello World!"]]\n'})}),"\n",(0,i.jsx)(n.p,{children:"it behaves like a symbol."}),"\n",(0,i.jsx)(n.admonition,{type:"tip",children:(0,i.jsxs)(n.p,{children:["You don't have to always use ",(0,i.jsx)(n.a,{href:"/frontend/Reference/Frontend%20Objects/CreateFrontEndObject",children:"CreateFrontEndObject"}),". It is possible to force Wolfram Kernel to apply it automatically on output using ",(0,i.jsx)(n.a,{href:"/frontend/Reference/Decorations/MakeBoxes",children:"MakeBoxes"})]})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsxs)(n.strong,{children:["This is basically how ",(0,i.jsx)(n.a,{href:"/frontend/Reference/Graphics/",children:"Graphics"})," and others are implemented."]})}),"\n",(0,i.jsx)(n.h2,{id:"data-fetching",children:"Data fetching"}),"\n",(0,i.jsx)(n.p,{children:"A back communication is also possible"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",metastring:'title="cell 1"',children:".js\n\ncore.MyFunction3 = async (args, env) => {\n  return [1,2,3,4,5,6];\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"and to read it synchronously"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mathematica",metastring:'title="cell 2"',children:"FrontFetch[MyFunction3[]]\n"})}),"\n",(0,i.jsx)(n.p,{children:"or asynchronously"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mathematica",metastring:'title="cell 2"',children:"Then[FrontFetchAsync[MyFunction3[]], Function[data, Print[data]]]\n"})}),"\n",(0,i.jsx)(n.h2,{id:"emitting-events",children:"Emitting events"}),"\n",(0,i.jsxs)(n.p,{children:["We can call any WL function using ",(0,i.jsx)(n.a,{href:"/frontend/Reference/Misc/Events",children:"Events"})," system"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",metastring:'title="cell 1"',children:".js\n\nconst button = document.createElement('button');\nbutton.innerText = \"Press me\";\n\nbutton.addEventListener('click', () => {\n  server.kernel.emitt('eventUid', 'True');\n});\n\nreturn button;\n"})}),"\n",(0,i.jsx)(n.p,{children:"Now we can capture it using"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mathematica",metastring:'title="cell 2"',children:'EventHandler["eventUid", Print]\n'})}),"\n",(0,i.jsx)(n.h3,{id:"custom-ui-component",children:"Custom UI component"}),"\n",(0,i.jsx)(n.p,{children:"Using JS one can craft its own UI components. For example"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",metastring:'title="cell 1"',children:".js\n\ncore.MyCustomComponent = async (args, env) => {\n  const label = await interpretate(args[0], env);\n  const ev = await interpretate(args[1], env);\n  \n  const button = document.createElement('button');\n  button.innerText = label;\n  button.style.backgroundColor = \"lightblue\";\n\n  button.addEventListener('click', () => {\n    server.kernel.emitt(ev, 'True');\n  });\n\n  env.element.appendChild(button);\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"Now we can make boxes for it"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mathematica",metastring:'title="cell 2"',children:"MyCustomComponent /: MakeBoxes[m_MyCustomComponent, StandardForm] := With[{\n  o = CreateFrontEndObject[m]\n},\n  MakeBoxes[o, StandardForm]\n]\n"})}),"\n",(0,i.jsx)(n.p,{children:"In action"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mathematica",metastring:'title="cell 3"',children:'MyCustomComponent["Click me pls", "event1"]\nEventHandler["event1", Print];\n'})}),"\n",(0,i.jsx)(n.h3,{id:"integrating-with-standard-inputs",children:"Integrating with standard inputs"}),"\n",(0,i.jsxs)(n.p,{children:["It is much easier to work with ",(0,i.jsx)(n.a,{href:"/frontend/Reference/Misc/Events#%60EventObject%60",children:(0,i.jsx)(n.code,{children:"EventObject"})})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mathematica",metastring:'title="cell 3"',children:'ClearAll[MyCustomComponent]\n\nMyCustomInput[label_String] := With[{uid = CreateUUID[]},\n  EventObject[<|"Id"->uid, "View"->MyCustomComponent[label, uid]|>]\n]\n'})}),"\n",(0,i.jsxs)(n.p,{children:["in action it behaves similar to ",(0,i.jsx)(n.a,{href:"/frontend/Reference/GUI/InputRange",children:"InputRange"})," and etc"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mathematica",metastring:'title="cell 4"',children:'EventHandler[MyCustomInput["Click me"], Print]\n'})}),"\n",(0,i.jsx)(n.h3,{id:"using-wlx",children:"Using WLX"}),"\n",(0,i.jsxs)(n.p,{children:["It is much easier to write markup in ",(0,i.jsx)(n.a,{href:"/frontend/Cell%20types/WLX",children:"WLX"})," compared to JS"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-jsx",metastring:'title="cell 1"',children:'.wlx\n\nMyCustomComponent2[OptionsPattern[]] := With[{\n  Event = OptionValue["Event"],\n  Label = OptionValue["Label"],\n  Uid = CreateUUID[]\n},\n  <div>\n    <button id="{Uid}" style="background: lightblue" class="p-1">\n      <Label/>\n    </button>\n    <script type="module">\n      document.getElementById(\'<Uid/>\').addEventListener(\'click\', () => {\n\n          server.kernel.emitt(\'<Event/>\', \'True\');\n      })\n    <\/script>\n  </div>\n]\n\nOptions[MyCustomComponent2] = {"Event" -> "", "Label" -> "Click me"};\n'})}),"\n",(0,i.jsx)(n.p,{children:"In action"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mathematica",metastring:'title="cell 2"',children:'MyCustomComponent2["Event"->"test", "Label"->"Hello World!"] // WLXEmbed\nEventHandler["test", Print];\n'})}),"\n",(0,i.jsx)(n.p,{children:"or combining with a previous technic"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mathematica",metastring:'title="cell 2"',children:'MyCustomInput2[label_String] := With[{uid = CreateUUID[]},\n  EventObject[<|"Id"->uid, "View"-> WLXEmbed[MyCustomComponent2["Label"->label, "Event"->uid]]|>]\n]\n'})}),"\n",(0,i.jsx)(n.p,{children:"You can use it as a normal input element"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mathematica",metastring:'title="cell 3"',children:'EventHandler[MyCustomInput2["Click me"], Print]\n'})}),"\n",(0,i.jsx)(n.h4,{id:"side-effects",children:"Side effects"}),"\n",(0,i.jsxs)(n.p,{children:["To call another function ",(0,i.jsx)(n.strong,{children:"after an elements was drawn"}),", use an options of ",(0,i.jsx)(n.a,{href:"/frontend/Reference/GUI/WLXEmbed",children:"WLXEmbed"}),". This is used for dynamic updates in ",(0,i.jsx)(n.a,{href:"/frontend/Reference/GUI/TextView",children:"TextView"})," and ",(0,i.jsx)(n.a,{href:"/frontend/Reference/GUI/HTMLView",children:"HTMLView"})," implementations."]}),"\n",(0,i.jsx)(n.h3,{id:"emit-event-from-wljs",children:"Emit event from WLJS"}),"\n",(0,i.jsxs)(n.p,{children:["One can fire an event also using frontend's function ",(0,i.jsx)(n.code,{children:"EventFire"}),", which is effectively acts like ",(0,i.jsx)(n.code,{children:"server.kernel.emitt"})," being called from the WLJS Interpreter (i.e. using ",(0,i.jsx)(n.a,{href:"/frontend/Reference/Frontend%20IO/FrontSubmit",children:"FrontSubmit"})," or other and wrapped in ",(0,i.jsx)(n.a,{href:"/frontend/Reference/Interpreter/Offload",children:"Offload"}),")"]}),"\n",(0,i.jsx)(n.admonition,{type:"danger",children:(0,i.jsx)(n.p,{children:"Not implemented!"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mathematica",children:'EventHandler["internalEvent", Print];\nFrontSubmit[EventFire["internalEvent", ReadClipboard[]] // Offload]\n'})}),"\n",(0,i.jsx)(n.p,{children:"It will send an expression to be executed on the frontend, that reads a clipboard and fires back an event with a fetched data."}),"\n",(0,i.jsx)(n.h2,{id:"request-evaluation",children:"Request evaluation"}),"\n",(0,i.jsxs)(n.p,{children:["It is also possible from Javascript to request an evaluation of any symbol using ",(0,i.jsx)(n.a,{href:"https://jerryi.github.io/wlx-docs/docs/Reference/Misc/WLJSTransport#server",children:(0,i.jsx)(n.code,{children:"server"})})," object"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:".js\n\nconst doc = document.createElement('span');\n\nconst run = async () => {\n  const data = await server.kernel.ask('RandomReal[{-1,1}, 3]');\n  const result = await interpretate(data, {});\n  doc.innerText = result.join(', ');\n}\n\nrun();\n\nreturn doc;\n"})})]})}function h(e={}){const{wrapper:n}={...(0,a.M)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},4552:(e,n,t)=>{t.d(n,{I:()=>c,M:()=>s});var i=t(11504);const a={},r=i.createContext(a);function s(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:s(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);