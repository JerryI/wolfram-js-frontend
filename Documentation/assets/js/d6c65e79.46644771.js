"use strict";(self.webpackChunkwlx_docs=self.webpackChunkwlx_docs||[]).push([[816],{83452:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>d});var a=t(17624),o=t(4552);const r={env:["Wolfram Kernel","WLJS"],source:"https://github.com/JerryI/wljs-interpreter/blob/dev/src/Definitions.wl",context:"JerryI`Misc`WLJS`Transport`",package:"wljs-interpreter"},i=void 0,s={id:"frontend/Reference/Interpreter/Offload",title:"Offload",description:"Holds (or offloads) an expression to be evaluated on frontend (WLJS)",source:"@site/docs/frontend/Reference/Interpreter/Offload.md",sourceDirName:"frontend/Reference/Interpreter",slug:"/frontend/Reference/Interpreter/Offload",permalink:"/frontend/Reference/Interpreter/Offload",draft:!1,unlisted:!1,tags:[],version:"current",lastUpdatedAt:1712600483,formattedLastUpdatedAt:"Apr 8, 2024",frontMatter:{env:["Wolfram Kernel","WLJS"],source:"https://github.com/JerryI/wljs-interpreter/blob/dev/src/Definitions.wl",context:"JerryI`Misc`WLJS`Transport`",package:"wljs-interpreter"},sidebar:"tutorialSidebar",previous:{title:"FrontEndVirtual",permalink:"/frontend/Reference/Interpreter/FrontEndVirtual"},next:{title:"ReadClipboard",permalink:"/frontend/Reference/Interpreter/ReadClipboard"}},l={},d=[{value:"Options",id:"options",level:2},{value:"<code>&quot;Volatile&quot;</code>",id:"volatile",level:3},{value:"<code>&quot;Static&quot;</code>",id:"static",level:3},{value:"Examples",id:"examples",level:2},{value:"Symbols tracking and deferred evaluation",id:"symbols-tracking-and-deferred-evaluation",level:3},{value:"Force WL Kernel to offload an expression",id:"force-wl-kernel-to-offload-an-expression",level:3},{value:"Dev notes",id:"dev-notes",level:2}];function c(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",strong:"strong",...(0,o.M)(),...e.components},{Wl:t}=n;return t||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Wl",!0),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.p,{children:"Holds (or offloads) an expression to be evaluated on frontend (WLJS)"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-mathematica",children:"Offload[expr_, opts___]\n"})}),"\n",(0,a.jsxs)(n.p,{children:["It has ",(0,a.jsx)(n.code,{children:"HoldFirst"})," attribute."]}),"\n",(0,a.jsx)(n.admonition,{type:"info",children:(0,a.jsxs)(n.p,{children:["Please, see the tutorial ",(0,a.jsx)(n.a,{href:"/frontend/Dynamics",children:"Dynamics"})]})}),"\n",(0,a.jsx)(n.h2,{id:"options",children:"Options"}),"\n",(0,a.jsx)(n.h3,{id:"volatile",children:(0,a.jsx)(n.code,{children:'"Volatile"'})}),"\n",(0,a.jsxs)(n.p,{children:["Blocks or allows dynamic updates. Only normal evaluation will be allowed if it is set to ",(0,a.jsx)(n.code,{children:"False"}),". The default values is ",(0,a.jsx)(n.code,{children:"True"})]}),"\n",(0,a.jsx)(n.admonition,{type:"warning",children:(0,a.jsxs)(n.p,{children:["In such case an expression will not be evaluated during the updates and will return undefined value. Use it only in constructions like ",(0,a.jsx)(n.code,{children:"CompoundExpression"})]})}),"\n",(0,a.jsx)(n.h3,{id:"static",children:(0,a.jsx)(n.code,{children:'"Static"'})}),"\n",(0,a.jsxs)(n.p,{children:["Prevents or allows a parent instance to listen changes of an inner expression. The default value is ",(0,a.jsx)(n.code,{children:"False"}),"."]}),"\n",(0,a.jsxs)(n.admonition,{type:"tip",children:[(0,a.jsx)(n.p,{children:"The typical case scenario is you don't want to create extra bondings between an objects and other dynamic symbols."}),(0,a.jsx)(n.p,{children:"For example"}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-mathematica",children:"Line[{{0, a // Offload}, {1, a // Offload}}]\n"})}),(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Line will be reevalauted 2 times instead of 1"}),". \ud83d\udd14 Since each instance of ",(0,a.jsx)(n.code,{children:"a"})," causes the bond creation and reevaluation, once ",(0,a.jsx)(n.code,{children:"a"})," has been changed."]}),(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Solution 1"})," \ud83d\udc4d\ud83c\udffc"]}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-mathematica",children:"Line[With[{p = a}, {{0, p}, {1, p}}] // Offload]\n"})}),(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Solution 2"})," \ud83d\udc4d\ud83c\udffc"]}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-mathematica",children:'Line[{{0, a // Offload}, {1, Offload[a, "Static"->True]}}]\n'})})]}),"\n",(0,a.jsx)(n.h2,{id:"examples",children:"Examples"}),"\n",(0,a.jsx)(n.h3,{id:"symbols-tracking-and-deferred-evaluation",children:"Symbols tracking and deferred evaluation"}),"\n",(0,a.jsx)(n.p,{children:"Typical example for the dynamic evaluation"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-mathematica",children:"pts = RandomReal[{-1,1}, {64, 2}];\nGraphics[{PointSize[0.02], Point[pts // Offload]}, ImageSize->500]\n"})}),"\n",(0,a.jsx)(t,{data:"WyJHcmFwaGljcyIsWyJMaXN0IixbIlBvaW50U2l6ZSIsMi4wZS0yXSxbIlBvaW50IixbIkhvbGQi\nLFsiUmFuZG9tUmVhbCIsWyJMaXN0IiwtMSwxXSxbIkxpc3QiLDY0LDJdXV1dXSxbIlJ1bGUiLCJJ\nbWFnZVNpemUiLDUwMF1d\n",children:"Graphics[{PointSize[0.02], Point[RandomReal[{-1,1}, {64, 2}] // Offload]}, ImageSize->500]"}),"\n",(0,a.jsx)(n.admonition,{type:"note",children:(0,a.jsx)(n.p,{children:"Try to update the page. Each time the distribution of points will be different"})}),"\n",(0,a.jsx)(n.p,{children:"Now the symbol was actually evaluated on the frontend (browser/ client) using fetched data from the server."}),"\n",(0,a.jsx)(n.p,{children:"And then, change the variable from the separate task"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-mathematica",children:"task = SetInterval[With[{},\n  pts = (# + 0.001 Sum[\n    (i - #)/(Norm[i - #]^3 + 0.1) - (i - #)/(Norm[i - #]^5 + 0.1)\n  , {i, pts}]) &/@ pts;\n], 100]\n"})}),"\n",(0,a.jsx)(n.p,{children:"Don't forget to remove it afterwards"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-mathematica",children:"TaskRemove[task]\n"})}),"\n",(0,a.jsx)(n.h3,{id:"force-wl-kernel-to-offload-an-expression",children:"Force WL Kernel to offload an expression"}),"\n",(0,a.jsxs)(n.p,{children:["Looking back to the previous example, the function  ",(0,a.jsx)(n.code,{children:"RandomReal"})," implemented on both sides. If you offload it to the ",(0,a.jsx)(n.code,{children:"Point"})," expression"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-mathematica",children:"Graphics[{PointSize[0.02], Point[RandomReal[{-1,1}, {64, 2}] // Offload]}]\n"})}),"\n",(0,a.jsx)(n.p,{children:"Each time you load a notebook the distribution of the point will be different, since it reevaluate it on frontend's side each time."}),"\n",(0,a.jsx)(n.h2,{id:"dev-notes",children:"Dev notes"}),"\n",(0,a.jsx)(n.p,{children:"The actual implementation of the expression is extremely simple"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-mathematica",children:"SetAttributes[Offload, HoldFirst]\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",children:"core.Offload = async (args, env) => {\n\treturn await intepretate(args[0], env)\n}\ncore.Offload.update = core.Offload\ncore.Offload.destroy = core.Offload\n"})}),"\n",(0,a.jsxs)(n.p,{children:["The difference from ",(0,a.jsx)(n.code,{children:"Hold"})," is that it will not be affected by ",(0,a.jsx)(n.code,{children:"ReleaseHold"}),"."]})]})}function h(e={}){const{wrapper:n}={...(0,o.M)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},4552:(e,n,t)=>{t.d(n,{I:()=>s,M:()=>i});var a=t(11504);const o={},r=a.createContext(o);function i(e){const n=a.useContext(r);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),a.createElement(r.Provider,{value:n},e.children)}}}]);